!function(e){e.fn.extend({BlackAndWhite:function(t){"use strict";var n=this,i={hoverEffect:!0,webworkerPath:!1,responsive:!0,invertHoverEffect:!1,speed:500,onImageReady:null,intensity:1},a=(t=e.extend(i,t)).hoverEffect,o=t.webworkerPath,r=t.invertHoverEffect,s=t.responsive,d="number"==typeof t.intensity&&t.intensity<1&&t.intensity>0?t.intensity:1,c=e.isPlainObject(t.speed)?t.speed.fadeIn:t.speed,f=e.isPlainObject(t.speed)?t.speed.fadeOut:t.speed,u=!(!document.all||window.opera||!window.XMLHttpRequest),l=" -webkit- -moz- -o- -ms- ".split(" "),m={},g=function(e){if(m[e]||""===m[e])return m[e]+e;var t=document.createElement("div"),n=["","Moz","Webkit","O","ms","Khtml"];for(var i in n)if(void 0!==t.style[n[i]+e])return m[e]=n[i],n[i]+e;return e.toLowerCase()},h=function(){var e=document.createElement("div");return e.style.cssText=l.join("filter:blur(2px); "),!!e.style.length&&(void 0===document.documentMode||document.documentMode>9)}(),p=!!document.createElement("canvas").getContext,v=e(window),w="undefined"!=typeof Worker,y=(g("Filter"),[]),I=!(!w||!o)&&new Worker(o+"BnWWorker.js"),W=function(t){e(t.currentTarget).find(".BWfade").stop(!0,!0)[r?"fadeOut":"fadeIn"](f)},B=function(t){e(t.currentTarget).find(".BWfade").stop(!0,!0)[r?"fadeIn":"fadeOut"](c)},b=function(e){"function"==typeof t.onImageReady&&t.onImageReady(e)},k=function(){if(!y.length)return I.terminate&&I.terminate(),void(I.close&&I.close());I.postMessage({imgData:y[0].imageData,intensity:d}),I.onmessage=function(e){y[0].ctx.putImageData(e.data,0,0),b(y[0].img),y.splice(0,1),k()}},x=function(e,t,n,i){var a=t.getContext("2d"),o=0;a.drawImage(e,0,0,n,i);var r=a.getImageData(0,0,n,i),s=r.data,c=s.length;if(I)y.push({imageData:r,ctx:a,img:e});else{for(;o<c;o+=4){var f=.3*s[o]+.59*s[o+1]+.11*s[o+2];s[o]=~~(f*d+s[o]*(1-d)),s[o+1]=~~(f*d+s[o+1]*(1-d)),s[o+2]=~~(f*d+s[o+2]*(1-d))}a.putImageData(r,0,0),b(e)}},D=function(t,n){var i=t[0],a=i.src,o=t.width(),s=t.height(),c=t.position(),f={position:"absolute",top:c.top,left:c.left,display:r?"none":"block"};if(p&&!h){var u=i.width,l=i.height;e('<canvas class="BWfade" width="'+u+'" height="'+l+'"></canvas>').prependTo(n);var m=n.find("canvas");m.css(f),x(i,m[0],u,l)}else f[g("Filter")]="grayscale("+100*d+"%)",e("<img src="+a+' width="'+o+'" height="'+s+'" class="BWFilter BWfade" /> ').prependTo(n),e(".BWFilter").css(e.extend(f,{filter:"progid:DXImageTransform.Microsoft.BasicImage(grayscale=1)"})),b(i)};return this.init=function(t){n.each(function(t,n){var i=e(n),a=i.find("img");a.width()?D(a,i):a.on("load",function(){D(a,i)})}),I&&k(),a&&(n.on("mouseleave",W),n.on("mouseenter",B)),s&&v.on("resize orientationchange",n.resizeImages)},this.resizeImages=function(){n.each(function(t,n){var i=e(n).find("img:not(.BWFilter)"),a=u?e(i).prop("width"):e(i).width(),o=u?e(i).prop("height"):e(i).height();e(this).find(".BWFilter, canvas").css({width:a,height:o})})},this.init(t)}})}(jQuery);